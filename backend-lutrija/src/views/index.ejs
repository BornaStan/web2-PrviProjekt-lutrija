<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Lutrija</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <div class="container">
    <header>
    <% if (isAuthenticated) { %>
      <p>Prijavljeni ste kao <strong><%= user?.name || user?.email %></strong></p>
      <a href="/logout" class="button">Odjava</a>
    <% } else { %>
      <a href="/login" class="button">Prijava</a>
    <% } %>
    </header>
    <h1>Dobrodošli u Loto aplikaciju</h1>

    <% if (round) { %>
      <p>Trenutno kolo ID: <%= round.id %></p>
    <% } else { %>
      <p>Trenutno nema aktivnog kola.</p>
    <% } %>

    <% if (isAuthenticated) { %>
      <p>Broj uplaćenih listića: <strong><%= ticketsCount || 0 %></strong></p>
    <% } %>

    <% if (results && results.results_numbers) { %>
      <h3>Izvučeni brojevi:</h3>
      <p><%= results.results_numbers.join(", ") %></p>
    <% } else { %>
      <p>Još nema izvučenih brojeva.</p>
    <% } %>

    <% if (userTickets && userTickets.length > 0) { %>
    <h3>Vaši listići:</h3>
    <ul style="list-style: none; padding: 0;">
      <% userTickets.forEach(ticket => { %>
        <li style="margin-bottom: 15px; border-bottom: 1px solid #ddd; padding-bottom: 10px;">
          <strong>Listić #<%= ticket.id %>:</strong> <%= ticket.numbers.join(', ') %>
          <button 
            class="button" 
            style="margin-left: 10px; padding: 4px 10px; font-size: 0.9rem;"
            onclick="toggleDetails('<%= ticket.id %>')">
            Detalji
          </button>

          <div id="details-<%= ticket.id %>" style="display: none; margin-top: 10px;">
            <p><strong>Broj osobne iskaznice:</strong> <%= ticket.document_number %></p>
            <p><strong>Kolo:</strong> <%= ticket.round_id %></p>

            <% if (ticket.qr_code_url) { %>
              <div class="qr-box">
                <img src="<%= ticket.qr_code_url %>" alt="QR kod listića">
              </div>
            <% } %>
            <p><a class="link" href="/ticket/<%= ticket.id %>">Otvori QR kod</a></p>
          </div>
        </li>
      <% }) %>
    </ul>

    <script>
      function toggleDetails(ticketId) {
        const details = document.getElementById('details-' + ticketId);
        details.style.display = details.style.display === 'none' ? 'block' : 'none';
      }
    </script>
  <% } %>

    <% if (round && round.is_active && isAuthenticated) { %>
      <a href="/ticket" class="button">Uplati listić</a>
    <% } else if (!isAuthenticated) { %>
      <p style="margin-top: 20px; color: #555;">Za uplatu listća potrebna je prijava</p>
    <% } else { %>
      <p>Uplate trenutno nisu aktivne.</p>
    <% } %>
  </div>
</body>
</html>